---
title: "Auth2.0"
date: 2018-02-28T17:59:26+08:00
lastmod: 2018-02-28T17:59:26+08:00
draft: false
keywords: [auth2]
description: ""
tags: [auth]
categories: [auth]
author: "mimiasd"

# You can also close(false) or open(true) something for this content.
# P.S. comment can only be closed
# comment: false
# toc: true
# autoCollapseToc: false
# postMetaInFooter: false
# You can also define another contentCopyright. e.g. contentCopyright: "This is another copyright."
contentCopyright: false
# reward: false
# mathjax: false
mathjaxEnableSingleDollar: false
---

> [OAuth2.0 RFC](https://tools.ietf.org/html/rfc6749)

# 1. 简介

　　传统客户端-服务端认证模型中，是客户端用资源拥有者的证书去访问受限资源。而当资源拥有者把证书给第三方应用时，会出现以下问题和限制：

- 第三方应用要求储存该证书，以备后用，通常是一个明文密码。

- 服务端需要支持密码认证，而密码认证的方式在安全方面存在与生俱来的缺点。

- 第三方应用获得了过大的权限，导致资源拥有者无法限制首先资源的子集。

- 资源拥有者不能撤回单个第三方应用，只能通过改变第三方应用的密码，收回所有第三方应用的权限。

- 妥协任何第三方应用，就会给这个第三方应用的终端用户密码，以及密码关联的所有受保护资源。

　　OAuth 引入了授权层，把资源所有者和客户端角色分开，来解决上面的问题。在 OAuth 中，客户端请求服务端的受限资源，并且被发一系列不同于资源拥有者的证书。  

　　客户端获得一个表示特定范围、生命周期和其他访问属性的字符串 - `token`，来代替直接使用资源拥有者的证书，访问受限资源。资源访问者允许后，通过授权服务器发放令牌给第三方客户端。客户端利用这个令牌来访问受限资源。  

　　例如，一个终端用户(资源拥有者)，可以授予一个打印服务(客户端)存储在相片分享服务器(资源服务器)上到受保护的照片，而不用把她的帐号和密码告诉打印服务。作为代替，她直接授权给被相片分享服务(认证服务器)信任的服务，认证服务器将分发特殊指派的证书(访问令牌)给打印服务器。  

　　该说明书用于 HTTP。基于其他协议的 OAuth，不在该说明书讨论范围内。

## 1.1 角色

  OAuth 定义了四个角色：

- 资源拥有者(resource owner)
  - 有能力授予一个受限资源访问权限的实体。当资源拥有者是一个人时，它指代一个终端用户。

- 资源服务器(resource server)
  - 储存着受保护资源的服务，有能力接收和响应，使用访问令牌的受保护资源请求。

- 客户端(client)
  - 通过资源拥有者授权，代表资源拥有者发出对受限资源请求的一个应用。术语 "client" 不表示任何特殊的实现特性(例如：不管这个应用运行在服务器，桌面环境，或者其他设备上)。

- 授权服务器(authorization server)
  - 在成功鉴定资源拥有者，并获得其授权后，授权服务发布访问令牌给客户端。

## 1.2 协议流程

```
+--------+                               +---------------+
|        |--(A)- Authorization Request ->|   Resource    |
|        |                               |     Owner     |
|        |<-(B)-- Authorization Grant ---|               |
|        |                               +---------------+
|        |
|        |                               +---------------+
|        |--(C)-- Authorization Grant -->| Authorization |
| Client |                               |     Server    |
|        |<-(D)----- Access Token -------|               |
|        |                               +---------------+
|        |
|        |                               +---------------+
|        |--(E)----- Access Token ------>|    Resource   |
|        |                               |     Server    |
|        |<-(F)--- Protected Resource ---|               |
+--------+                               +---------------+
             Figure 1: Abstract Protocol Flow
```

　　OAuth2.0 的步骤如下：

- ( A ) 客户端请求资源拥有者授权。授权请求可以直接发送给资源拥有者，或者更好地，间接地通过一个中介授权服务器。

- ( B ) 客户端获得一个授权，这是一个代表资源拥有者认可的证书，该证书使用本说明书定义的四种授权类型之一或扩展授权类型。认证授权类型取决于客户端请求授权的方法，以及授权服务器支持的类型。

- ( C ) 客户端提交授权许可，请求一个通过授权服务器验证的访问令牌。

- ( D ) 授权服务器认可客户端，并确认使授权许可，如果有效，则发放令牌。

- ( E ) 客户端通过令牌访问受限资源。

- ( F ) 资源服务器确认令牌，如果有效，则响应请求。

## 1.3 授权许可

　　授权许可是一个代表资源拥有者授权的证书，用于获得访问令牌。该说明书定义四种许可类型 - 授权码模式、简化模式、资源拥有者密码模式和客户端证书模式，以及一个可扩展机制来定义额外的类型。

### 1.3.1 授权码模式

　　授权码通过一个客户端和资源拥有者之间的中介授权服务器获得。客户端把资源拥有者指向一个授权服务器(通过一个用户代理)，而授权服务器又反过来把资源拥有者带上授权码指向回客户端。

　　在带上授权码反指向回客户端之前，授权服务器要验证资源拥有者的身份，并获得授权。因为资源拥有者之授权给授权服务器，所以资源拥有者的证书永远不会分享给客户端。

　　授权码模式提供了一些重要的安全特性，比如授权给客户端，以及直接把访问令牌传给客户端，而不是传给可能泄露给包括资源拥有者的其他人的资源拥有者用户代理。

### 1.3.2 简化模式

　　针对浏览器客户端优化的简化授权码模式。在简化模式中，客户端被直接发放一个访问令牌，而不是一个授权码。

　　在简化授权模式流中发放一个访问令牌时，授权服务器不验证客户端的身份。在一些情境下，客户端的身份可以用重定向的 URI 来验证，这是被用来传递访问令牌给客户端的。访问令牌可能暴露给资源拥有者或者其他可以访问资源拥有者用户代理的应用。

　　简化授权模式改进了一个客户端的响应和效率(例如浏览器应用)，因为它减少了获得访问令牌的来回请求数量。但这个好处必须与简化模式的安全性一起衡量。

### 1.3.3 资源拥有者密码模式

　　密码模式(比如：用户和密码)可以直接当作授权码来获得访问令牌。这个证书只适用于客户端和资源拥有者之间有很高信任度(例如：客户端是设备操作系统的一部分或是一个高优先级的应用)
，或者其他授权类型不可用的情况下。

　　即使该授权类型需要把客户端访问指向资源拥有者证书，而资源拥有者的诊所过户只需要一个请求来换取访问令牌。该类型可以避免客户端存储资源拥有者的证书，同一个交换一个长存的访问令牌或更新令牌。

### 1.3.4 客户端证书模式

　　当受限资源在客户端的控制之下，或受限资源预先安排给了访问服务器。客户端代表它自己来访问受限资源。

## 1.4 访问令牌

 访问受限资源的证书。是发放给客户端代表一个认证的字符串。该字符串对于客户端是不透明的。令牌代表特定的访问范围和期间，由资源拥有者授予，资源服务器和授权服务器执行。
 
 令牌可能以一种可证实的方式指示一个可以取回认证信息或自包涵认证信息的标志符(例如：令牌字符串由一些数据和一个签名组成)。
 
 访问令牌提供一个抽象层，代替带有被资源服务器理解的单一令牌的不同认证设计(例如：用户名和密码)。这种抽象使发布访问令牌比使用它们的授权许可更严格，同时消除了资源服务器去理解大范围认证方法的需求。
 
 访问令牌可以有不同的格式、结构和利用方法(例如：加密属性)，这取决于资源服务器的安全需要。令牌的属性和保护资源的方法，可以参考[RFC6750](https://tools.ietf.org/html/rfc6750)。





















